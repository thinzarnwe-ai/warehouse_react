!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).jssdk=r()}(this,(function(){"use strict";var e,r;const n=null===(r=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent)||void 0===r?void 0:r.toLocaleLowerCase(),t=-1!==(null==n?void 0:n.indexOf("android")),o=Symbol("currentRoute"),a=Symbol("isInitd"),i=Symbol("tabBar"),s=Symbol("canNavigateTo"),l="__ma__global__",u={[o]:"",[a]:!1,[i]:null,[s]:!0};function c(e,r){u[e]=r}function d(e){return window[l][e]}window[l]=u;const f={MiniProgram:{NAVIGATE_TO:"navigateTo",NAVIGATE_BACK:"navigateBack",REDIRECT_TO:"redirectTo",SWITCH_TAB:"switchTab",RE_LAUNCH:"reLaunch",POST_MESSAGE:"postMessage",CLOSE:"close"},Native:{CHOOSE_IMAGE:"chooseImage",GET_LOCAL_IMG_DATA:"getLocalImgData",GET_LOCATION:"getLocation",PREVIEW_IMAGE:"previewImage",OPEN_DOCUMENT:"openDocument",GET_STORAGE:"getStorage",SET_STORAGE:"setStorage",REMOVE_STORAGE:"removeStorage",CLEAR_STORAGE:"clearStorage",GET_NETWORK_TYPE:"getNetworkType",SCAN_CODE:"scanCode",GET_STATUS_BAR_HEIGHT:"getStatusBarHeight",CAPSULE_STYLE:"capsuleStyle",HIDE_LOADING:"hideLoading",SHOW_LOADING:"showLoading",SHOW_TOAST:"showToast",GET_SMALL_APP_INFO:"getsmallappinfo",GO_TO_BROWER:"gotoBrower",SAVE_FILE_TO_PHONE:"saveFileToPhone",SAVE_IMAGE:"saveImage",SAVE_BASE64_IMAGE:"saveBase64Image",CHECK_METHOD:"checkmethod",CHOOSE_CONTACT:"chooseContact",IS_ONLINE:"isOnline",REQUEST:"request",UPLOAD_FILE:"uploadFile",DOWNLOAD_FILE:"downloadFile",REPORT_PERFORMANCE:"reportPerformance",REPORT_LOG:"reportLog",SUBMIT_REPORT:"submitReport",PLAY_VOICE:"playVoice",PLAY_AUDIO:"playAudio",GET_BACKGROUND_FETCH_DATA:"getBackgroundFetchData",GET_LAUNCH_OPTIONS_SYNC:"getLaunchOptionsSync",GET_SYSTEM_INFO_SYNC:"getSystemInfoSync",NAVIGATE_TO_MINI_PROGRAM:"navigateToMiniProgram",STOP_AUOID:"stopVoice"}},m=void 0!==window.parent.__simulatorConfig__,v={};let p=0;function E(e,r={},n){const o=JSON.stringify(r),a=++p;v[a]=n,function(e,r,n){m?window.simulatorWebkit.messageHandlers.invoke.postMessage({command:e,inputParams:r,callbackId:n,type:"legacy"}):t?window.viewLayerNative.invoke(e,r,n):window.webkit.messageHandlers.invoke.postMessage({command:e,inputParams:r,callbackId:n})}(e,o,a)}function O(e,r,n={}){const t={};for(const e in r)"function"==typeof r[e]&&(t[e]=r[e],delete r[e]);E(e,r,((e,r)=>{var o,a,i,s,l,u,c,d,f,m,v;const p=0===Number(e),E=[1,-1].includes(Number(e));p?(null===(o=null==n?void 0:n.beforeAll)||void 0===o||o.call(n,r),null===(a=null==n?void 0:n.beforeSuccess)||void 0===a||a.call(n,r),null===(i=t.success)||void 0===i||i.call(t,r),null===(s=null==n?void 0:n.afterSuccess)||void 0===s||s.call(n,r)):E?(null===(l=null==n?void 0:n.beforeFail)||void 0===l||l.call(n,r),null===(u=t.fail)||void 0===u||u.call(t,r),null===(c=null==n?void 0:n.afterFail)||void 0===c||c.call(n,r)):(null===(d=null==n?void 0:n.beforeSuccess)||void 0===d||d.call(n,r),null===(f=null==t?void 0:t.preload)||void 0===f||f.call(t,r)),(p||E)&&(null===(m=t.complete)||void 0===m||m.call(t,r),null===(v=null==n?void 0:n.afterAll)||void 0===v||v.call(n,r))}))}function g(e,r={}){const n=JSON.stringify(r);m?window.simulatorWebkit.messageHandlers.notifyNative.postMessage({command:e,inputParams:n,type:"legacy"}):t?window.viewLayerNative.notifyNative(e,n):window.webkit.messageHandlers.notifyNative.postMessage({command:e,inputParams:n})}const _={},N="ma_custom_event_";function T(e,r){_[`${N}${e}`]=r}function b(e,r={}){const n=JSON.stringify(r);S(`${N}${e}`,n)}function S(e,r){m?window.simulatorWebkit.messageHandlers.notifyNative.postMessage({eventName:e,paramsString:r,type:"legacy"}):t?window.viewLayerNative.notifyNative(e,r):window.webkit.messageHandlers.notifyNative.postMessage({eventName:e,paramsString:r})}const A={invoke:E,invokeSync:function(e,r){const n=JSON.stringify(Object.assign({command:e},r));return window.prompt(n)},invokeMethod:O,beforeInvoke:function(e,r={},n={}){return r.success||r.fail||r.complete?O(e,r,n):new Promise(((t,o)=>{r.success=t,r.fail=o,O(e,r,n)}))},notifyNative:g,subscribe:T,webSubscribe:function(e,r){_[e]=r},publish:b,webPublish:function(e,r={}){S(e,JSON.stringify(r))}};function I(){if(!d(a)){c(a,!0);try{T("getCurrentRoute",(e=>{c(o,e.route),c(i,e.tabBar),c(s,void 0===e.canNavigateTo||e.canNavigateTo)})),b("getCurrentRoute")}catch(e){}}}class h extends Error{constructor(e,r){if(super(`${e} fail, ${r}`),this.fileName="",this.lineNumber=1,this.columnNumber=-1,this.name=this.constructor.name,!this.stack)return;const[,n,t=1,o]=this.stack.match(/\/([\/\w-_\.]+\.js):(\d*):(\d*)/)||[];this.fileName=n,this.lineNumber=Number(t),this.columnNumber=Number(o)}}const P="MACLE_ERROR_LOG",y={normalError(e){console.error(null==e?void 0:e.message),g(P,{key:e.key||"MacleApiError",errorStack:e.message,apiName:e.apiName,keywords:e.keywords,fwkVersion:"",file:e.file,line:e.line,column:e.column,timestamp:Date.now()})}};function R(e,r,n=!0){let t,o,a=r;if(n&&(a=function(e){const r=e.split("?");return r[0]+=".html",void 0===r[1]?r[0]:`${r[0]}?${r[1]}`}(a)),a.startsWith("/"))return a.substr(1);if(a.startsWith("./"))return R(e,a.substr(2),!1);const i=a.split("/");for(t=0,o=i.length;t<o&&".."===i[t];t++);i.splice(0,t);const s=e.length>0?e.split("/"):[];return s.splice(s.length-t-1,t+1),s.concat(i).join("/")}function C(e){const r=e.split("?"),[n,t]=r;if(!t)return e;const o=t.split("&").reduce(((e,r)=>{if("string"==typeof r&&r.length>0){const n=r.split("="),t=n[0],o=n[1];e[t]=o}return e}),Object.create(null)),a=[];for(const e in o)a.push(e+"="+encodeURIComponent(o[e]));return a.length>0?n+"?"+a.join("&"):e}function L(e,r){const n=d(i);if(null===n)return!0;r.url.startsWith("/")&&(r.url=r.url.slice(1));const t=(o=r.url,null==n?void 0:n.list.find((e=>0===o.indexOf(e.pagePath))));var o;return e!==f.MiniProgram.NAVIGATE_TO&&e!==f.MiniProgram.REDIRECT_TO||!t?!(e===f.MiniProgram.SWITCH_TAB&&!t)||(M(e,`${e}: can not ${e} to a non-tabbar page`),!1):(M(e,`${e}: can not ${e} to a tabbar page`),!1)}function k(e){return/^(http|https):\/\/.*/i.test(e)}function G(e){return Object.prototype.toString.call(e).split(" ")[1].split("]")[0]}function M(e,r){const n=new h(e,r);return y.normalError({message:n.message,file:n.fileName,line:n.lineNumber,column:n.columnNumber}),n}function w(e,r){if(U(e)&&D(r)&&Object.keys(r).length){const n=e.split("?")[0],t=e.split("?")[1],o={};t&&t.split("&").forEach((e=>{e.length&&(o[e.split("=")[0]]=e.split("=")[1])}));const a={};for(const[e,n]of Object.entries(r))D(n)?a[e]=JSON.stringify(n):a[e]=n;return`${n}?${function(e){if(!D(e))return e;const r=[];for(const n in e)try{r.push(`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`)}catch(t){r.push(`${n}=${e[n]}`)}return r.join("&")}(function(e,r){for(const[n,t]of Object.entries(r))e[n]=t;return e}(o,a))}`}return e}function U(e){return"String"===G(e)}function D(e){return"Object"===G(e)}function H(e,r,n){var t;const o=M(e,n);if(!r.success&&!r.fail&&!r.complete)return new Promise(((e,n)=>{r.fail=n,r.fail({errMsg:o.message})}));for(const e of["fail","complete"]){null===(t=r[e])||void 0===t||t.call(r,{errMsg:o.message})}return null}function F(e,r={},n){n&&"function"==typeof n?A.invoke(e,r,((r,t)=>{0===Number(r)?n(t):M(e,`${t.errMsg}`)})):M(e,"callback should be function!")}const j={miniProgram:{getEnv:function(e){e({miniprogram:"miniprogram"===window.__ma_environment})},navigateTo:function(e){if(!e.url)return H(f.MiniProgram.NAVIGATE_TO,e,"parameter error:parameter.url should be String instead of Undefined.");const r=e;r.url=R(d(o),r.url),r.url=C(r.url),L(f.MiniProgram.NAVIGATE_TO,r)&&A.beforeInvoke(f.MiniProgram.NAVIGATE_TO,r)},navigateBack:function(e){const r=Object.assign({delta:1},e);A.beforeInvoke(f.MiniProgram.NAVIGATE_BACK,r)},switchTab:function(e){if(!e.url)return H(f.MiniProgram.SWITCH_TAB,e,"parameter error:parameter.url should be String instead of Undefined.");const r=e;r.url=R(d(o),r.url),r.url=C(r.url),L(f.MiniProgram.SWITCH_TAB,r)&&A.beforeInvoke(f.MiniProgram.SWITCH_TAB,r)},reLaunch:function(e){if(!e.url)return H(f.MiniProgram.RE_LAUNCH,e,"parameter error:parameter.url should be String instead of Undefined.");const r=e;r.url=R(d(o),r.url),r.url=C(r.url),L(f.MiniProgram.RE_LAUNCH,r)&&A.beforeInvoke(f.MiniProgram.RE_LAUNCH,r)},redirectTo:function(e){if(!e.url)return H(f.MiniProgram.REDIRECT_TO,e,"parameter error:parameter.url should be String instead of Undefined.");const r=e;r.url=R(d(o),r.url),r.url=C(r.url),L(f.MiniProgram.REDIRECT_TO,r)&&A.beforeInvoke(f.MiniProgram.REDIRECT_TO,r)},postMessage:function(e){A.beforeInvoke(f.MiniProgram.POST_MESSAGE,e)},close:function(){A.invokeMethod(f.MiniProgram.CLOSE)},navigateBackMiniProgram(){},onWebviewEvent(){},offWebviewEvent(){},sendWebviewEvent(){},onShow(){},onHide(){},onUnload(){}},chooseImage:function(e){const r=Object.assign({count:9,sizeType:["original","compressed"],sourceType:["album","camera"]},e);return A.beforeInvoke(f.Native.CHOOSE_IMAGE,r)},getLocation:function(e){const r=Object.assign({useFetchData:!1},e);return A.beforeInvoke(f.Native.GET_LOCATION,r)},openDocument:function(e){return(null==e?void 0:e.filePath)?e.fileType&&-1===["doc","docx","xls","xlsx","ppt","pptx","pdf"].indexOf(e.fileType)?H(f.Native.OPEN_DOCUMENT,e,"parameter error:parameter.fileType is invalid value."):A.beforeInvoke(f.Native.OPEN_DOCUMENT,e):H(f.Native.OPEN_DOCUMENT,e,"parameter error:parameters.filePath should be String instead of Undefined.")},getStorage:function(e){if(!(null==e?void 0:e.key))return H(f.Native.GET_STORAGE,e,"parameter error:parameters.key should be String instead of Undefined.");const r=Object.assign({encrypt:!1},e);return A.beforeInvoke(f.Native.GET_STORAGE,r)},previewImage:function(e){return(null==e?void 0:e.urls)?A.beforeInvoke(f.Native.PREVIEW_IMAGE,e):H(f.Native.PREVIEW_IMAGE,e,"parameter error:parameter.urls should be Array instead of Undefined.")},setStorage:function(e){if(!(null==e?void 0:e.key)||!e.data)return H(f.Native.SET_STORAGE,e,"parameter error:parameter.key or parameter.data should not be Undefined.");const r=Object.assign({encrypt:!1},e);return A.beforeInvoke(f.Native.SET_STORAGE,r)},removeStorage:function(e){return(null==e?void 0:e.key)?A.beforeInvoke(f.Native.REMOVE_STORAGE,e):H(f.Native.REMOVE_STORAGE,e,"parameter error:parameter.key should be String instead of Undefined.")},clearStorage:function(e){return A.beforeInvoke(f.Native.CLEAR_STORAGE,e)},getNetworkType:function(e){return A.beforeInvoke(f.Native.GET_NETWORK_TYPE,e)},scanCode:function(e){const r=["barCode","qrCode","datamatrix","pdf417"];if((null==e?void 0:e.scanType)&&e.scanType.length>0&&!e.scanType.every((e=>r.indexOf(e)>-1)))return H(f.Native.SCAN_CODE,e,"parameter error:parameter.scanType contains invalid values.");const n=Object.assign({onlyFromCamera:!1,scanType:["barCode","qrCode"]},e);return A.beforeInvoke(f.Native.SCAN_CODE,n)},getLocalImgData:function(e){return(null==e?void 0:e.path)?A.beforeInvoke(f.Native.GET_LOCAL_IMG_DATA,e):H(f.Native.GET_LOCAL_IMG_DATA,e,"parameter error:parameter.path should be String instead of Undefined.")},callNativeAPI:F,native:function(e,r){const n=r||{};return new Promise(((r,t)=>{F(e,n,(e=>{r(e)}))}))},capsuleStyle:function(e){return-1===[0,1].indexOf(e.style)?H(f.Native.CAPSULE_STYLE,e,`parameter error: invalid style ${e.style}`):A.beforeInvoke(f.Native.CAPSULE_STYLE,e)},getStatusBarHeight:function(e){return A.beforeInvoke(f.Native.GET_STATUS_BAR_HEIGHT,e)},showLoading:function(e){const r=Object.assign({title:"",mask:!1},e);return A.beforeInvoke(f.Native.SHOW_LOADING,r)},hideLoading:function(e){return A.beforeInvoke(f.Native.HIDE_LOADING,e)},saveFileToPhone:function(e){return e.content?e.fileName?A.beforeInvoke(f.Native.SAVE_FILE_TO_PHONE,e):H(f.Native.SAVE_FILE_TO_PHONE,e,"parameter error:parameter.fileName should be String instead of Undefined."):H(f.Native.SAVE_FILE_TO_PHONE,e,"parameter error:parameter.content should be String instead of Undefined.")},showToast:function(e){if(!(null==e?void 0:e.title)&&!(null==e?void 0:e.message))return H(f.Native.SHOW_TOAST,e,"parameter error: prompt message should be String instead of Undefined.");if((null==e?void 0:e.message)&&(e.title=null==e?void 0:e.message),(null==e?void 0:e.icon)&&-1===["success","error","loading","none"].indexOf(null==e?void 0:e.icon))return H(f.Native.SHOW_TOAST,e,"parameter error:parameter.icon contains invalid values.");const r=Object.assign({icon:"success",duration:1500,mask:!1},e);return A.beforeInvoke(f.Native.SHOW_TOAST,r)},gotoBrower:function(e){return(null==e?void 0:e.openUrl)?A.beforeInvoke(f.Native.GO_TO_BROWER,e):H(f.Native.GO_TO_BROWER,e,"parameter error:parameter.openUrl should be String instead of Undefined.")},checkmethod:function(e){return(null==e?void 0:e.api)&&0!==e.api.length?A.beforeInvoke(f.Native.CHECK_METHOD,e):H(f.Native.CHECK_METHOD,e,"parameter error:parameter.api should be string or Array<string> instead of Undefined.")},saveImage:function(e){return(null==e?void 0:e.content)?A.beforeInvoke(f.Native.SAVE_IMAGE,e):H(f.Native.SAVE_IMAGE,e,"parameter error:parameter.content should be String instead of Undefined.")},saveBase64Image:function(e){return(null==e?void 0:e.base64)?A.beforeInvoke(f.Native.SAVE_BASE64_IMAGE,e):H(f.Native.SAVE_BASE64_IMAGE,e,"parameter error:parameter.base64 should be String instead of Undefined.")},isOnline:function(){return window.navigator.onLine},chooseContact:function(e){return A.beforeInvoke(f.Native.CHOOSE_CONTACT,e)},getsmallappinfo:function(e){return A.beforeInvoke(f.Native.GET_SMALL_APP_INFO,e)},downloadFile:function(e){return e.url?k(e.url)?A.beforeInvoke(f.Native.DOWNLOAD_FILE,e):H(f.Native.DOWNLOAD_FILE,e,`parameter error: invalid url ${e.url}`):H(f.Native.DOWNLOAD_FILE,e,"parameter error: parameter.url should be String instead of Undefined.")},request:function(e){const r=function(e){let r="";e.url||(r="parameter error: parameter.url should be String instead of Undefined.");k(e.url)||(r=`parameter error: invalid url ${e.url}`);e.data&&"Function"===G(e.data)&&(r="parameter error: data should not be Function.");return r}(e);if(r)return H(f.Native.REQUEST,e,r);e.header&&!D(e.header)&&(e.header={}),e.header=function(e){const r={};for(const n in e)switch(G(e[n])){case"String":r[n]=e[n];break;case"Number":case"Boolean":r[n]=`${e[n]}`;break;default:r[n]=JSON.stringify(e[n])}return r}(e.header||{});for(const r in e.header)if("content-type"===r.toLowerCase()){const n=e.header[r];delete e.header[r],e.header[r.toLowerCase()]=n}e.method=e.method?e.method.toUpperCase():"GET",e.dataType=e.dataType||"json",e.header["content-type"]=e.header["content-type"]||"application/json";let n="";e.data&&(n=D(e.data)?JSON.stringify(e.data):e.data),"GET"===e.method&&(e.url=w(e.url,e.data||{}));const t=Object.assign({data:n},e);return A.beforeInvoke(f.Native.REQUEST,t,{beforeSuccess(r){if("json"===e.dataType)try{r.data&&U(r.data)&&(r.data=JSON.parse(r.data))}catch(r){M(f.Native.REQUEST,`JSON parse data error from ${e.url}`)}}})},uploadFile:function(e){if(!e.url)return H(f.Native.UPLOAD_FILE,e,"parameter error: parameter.url should be String instead of Undefined.");if(e.files)e.filePath="",e.name="";else{if(!e.filePath)return H(f.Native.UPLOAD_FILE,e,"parameter error: parameter.filePath should be String instead of Undefined.");if(!e.name)return H(f.Native.UPLOAD_FILE,e,"parameter error: parameter.name should be String instead of Undefined.")}return A.beforeInvoke(f.Native.UPLOAD_FILE,e)},reportLog:function(e){if(!e.log||!D(e.log)&&!U(e.log))return H(f.Native.REPORT_LOG,e,"parameter error:  parameter.log should be Object or String instead of Undefined.");if(e.level&&-1===["debug","info","error"].indexOf(e.level))return H(f.Native.REPORT_LOG,e,`parameter error:  invalid level ${e.level}`);D(e.log)&&(e.log=JSON.stringify(e.log));const r=Object.assign({level:"info"},e);return A.notifyNative(f.Native.REPORT_LOG,r)},reportPerformance:function(e){return e.reportEvent&&U(e.reportEvent)?e.reportParams&&D(e.reportParams)?A.notifyNative(f.Native.REPORT_PERFORMANCE,e):H(f.Native.REPORT_PERFORMANCE,e,"parameter error:  parameter.reportParams should be Object instead of Undefined."):H(f.Native.REPORT_PERFORMANCE,e,"parameter error:  parameter.reportEvent should be String instead of Undefined.")},getBackgroundFetchData:function(e){return e.fetchType?A.beforeInvoke(f.Native.GET_BACKGROUND_FETCH_DATA,e):H(f.Native.GET_BACKGROUND_FETCH_DATA,e,"parameter error:parameter.fetchType should be string instead of Undefined.")},submitReport:function(e){return A.beforeInvoke(f.Native.SUBMIT_REPORT,e)},playAudio:function(e){return e.url?k(e.url)?A.beforeInvoke(f.Native.PLAY_VOICE,e):H(f.Native.PLAY_AUDIO,e,`parameter error: invalid url ${e.url}`):H(f.Native.PLAY_AUDIO,e,"parameter error:parameter.url should be String instead of Undefined.")},stopAudio:function(e){return A.beforeInvoke(f.Native.STOP_AUOID,e)},navigateToMiniProgram:function(e){return e.appId?function(e,r,n,t="parameter"){let o="";const a=G(r),i=G(n);if(a!==i)return o=`${t} should be ${i} instead of ${a};`,r.invalidParamObj=H(e,r,o),!1;if("Object"!==i)return!0;for(const[e,t]of Object.entries(n))if(Object.prototype.hasOwnProperty.call(r,e)){const n=G(t),a=G(r[e]);n!==a&&(o+=`${e} should be ${n} instead of ${a};`)}return!o||(r.invalidParamObj=H(e,r,o),!1)}(f.Native.NAVIGATE_TO_MINI_PROGRAM,e,{appId:"",path:"",params:""})?!e.path&&e.params?H(f.Native.NAVIGATE_TO_MINI_PROGRAM,e,"parameter error: there is params but no path."):A.beforeInvoke(f.Native.NAVIGATE_TO_MINI_PROGRAM,e):e.invalidParamObj:H(f.Native.NAVIGATE_TO_MINI_PROGRAM,e,"parameter error:parameter.appId should be String instead of Undefined.")},getLaunchOptionsSync:function(){const e=A.invokeSync(f.Native.GET_LAUNCH_OPTIONS_SYNC);return e&&JSON.parse(e)},getSystemInfoSync:function(){const e=A.invokeSync(f.Native.GET_SYSTEM_INFO_SYNC);return e&&JSON.parse(e)}};return"loading"!==document.readyState?I():document.addEventListener("DOMContentLoaded",I),window.onerror=function(e,r,n,t,o){y.normalError({key:"thirdPageParamsError",message:e,file:r,line:n,column:t})},window.ma=j,window.viewLayer={onInvokeFinished:function(e,r,n){const t=v[e];"function"==typeof t&&t(r,n),2!==Number(r)&&delete v[e]},subscribeHandler:function(e,r){return(0,_[e])(r)}},j}));
